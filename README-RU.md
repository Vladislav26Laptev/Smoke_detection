This page in [English](./README.md)

# ИИ для обнаружения лесных пожаров

 <p> Раннее обнаружение источника возгорания, точная локализация и принятие своевременных мер по тушению является актуальной задачей. Своевременное обнаружение и принятие соответствующих мер имеет решающее значение для предотвращения катастроф, что влечет за собой спасения жизней и сохранение имущества людей. </>
Система обнаружения пожара на основе технического зрения захватывает изображения с камер и немедленно обнаруживает возгорание, что делает ее пригодной для раннего обнаружения пожара. В рамках данного проекта планируется реализовать подключаемую библиотеку обнаружения возгорания и зоны распространения пожара. Преимуществом разрабатываемой библиотеки будет являться возможность подключаться к разным системам видеонаблюдения, работающих на основе стационарных камер.
 
## Оглавление
1. [Общее описание решения](#общее-описание-решения)
2. [Общее описание логики работы решения](#общее-описание-логики-работы-решения)
3. [Данные](#данные)
4. [Алгоритм обработки видеоряда](#алгоритм-обработки-видеоряда)
5. [Алгоритм обнаружения объекта](#алгоритм-обнаружения-объекта)
6. [Итог](#итог)
7. [Источники](#источники)

## Общее описание решения
Библиотека обнаружения пожара захватывает видео с камеры и разбивает его на фреймы для дальнейшей обработки. Нейронная сеть, базирующаяся на сверточных слоях, обрабатывает каждый полученный кадр. Результатом является ограничивающая рамка, которая выделяет область возгорания в кадре с некоторой вероятностью.

[:arrow_up:Оглавление](#оглавление)

## Общее описание логики работы решения
<p align="center">
  <img src="https://github.com/Vladislav26Laptev/Smoke_detection/blob/main/data/%D0%A1%D1%85%D0%B5%D0%BC%D0%B0.png">
</>
 
[:arrow_up:Оглавление](#оглавление)
 
## Данные
Для обучения модели были собраны и размечены видеозаписи, на которых имеется возгорание. Доступ к записям и аннотациям можно получить [по данной ссылке](https://yadi.sk/d/DACCsm_-FbeYmQ?w=1).
 В репозитории Dataset расположены скрипты
 ````
 create_dataset_od.py
 ````
для формирования датасета обучения сети object detection.

Файлы:
 ````
 dataset_label_od.py
 ````
 ````
 train_label_od.py
 ````
 ````
 val_label_od.py
 ````
являются результатом работы скрипта. Для обучения модели обнаружения объекта дополнительно необходимо запустить скрипт generate_tfrecord.py для генерации тренировочного и валидационного файла типа tfrecord. 
````
python generate_tfrecord.py --csv_input=Dataset/dataset_label_od.csv --output_path=train/train.tfrecord --image_dir=Dataset/images_od
````
 
[:arrow_up:Оглавление](#оглавление)
 
## Алгоритм обработки видеоряда
Сеть детектирования объектов в качестве входного элемента получает один кадр, для этого видеопоток преобразуется в последовательность кадров. Для последовательной обработки из последовательности выбираются 5 или более кадров с равным интервалом по времени, для последовательной обработки. Результатом будет усредненное предсказание для всех кадров, так как не исключена возможность взять кадр из последовательности в момент, когда возгорания не видно.
 
[:arrow_up:Оглавление](#оглавление)
 
## Алгоритм обнаружения объекта
Каждый выбранный кадр последовательно обрабатывается моделью распознавания объектов. Для решения поставленной задачи были протестированы следующие модели: EfficientDet-D1, SSD MobileNet v2, Faster R-CNN ResNet50 V1, Faster R-CNN Inception ResNet V2. Результат тестирования приведен в таблице:

 <p align="center">
  <img src="https://github.com/Vladislav26Laptev/Smoke_detection/blob/main/data/Model.png">
</p>
 
Из результатов таблицы видно, что наилучшие результаты в соотношении точность предсказания/скорость работы показывает модель EfficientDet-D1. Общая архитектура EfficientDet [1] в значительной степени соответствует парадигме одноступенчатых (one-stage) детекторов. За основу взята модель EfficientNet, предварительно обученная на датасете ImageNet. Для обучения сети требуются кадры с нанесенной разметкой в виде боксов с указанием соответствующего класса. С целью увеличения эффективности решения, а именно уменьшении времени работы и увеличении точности детектирования пожаров в лесном массиве, планируется рассмотреть и другие архитектуры семейства EfficientDet.
Для обнаружения объекта используется технология Object Detection фреймворка TensorFlow [2]. Для корректной работы необходимо загрузить репозиторий [Tensorflow Object Detection](https://github.com/tensorflow/models/tree/master/research/object_detection) в папку с проектом и запустить обучение, используя следующую команду:
````
python model_main_tf2.py --alsologtostderr --model_dir=model_od/efficientdet_d1_smoke --pipeline_config_path=model_od/efficientdet_d1/pipeline.config
````
Обучение модели проходило с использование видеокарты NVIDIA GeForce RTX 2080 Ti, время обучения модели составило ~ 14ч. Результат работы приведен ниже:
<p align="center">
  <img src="https://github.com/Vladislav26Laptev/Smoke_detection/blob/main/data/Res_1.png">
</>
 
Завершающим этапом является алгоритм постобработки, главной целью которого стоит объединение пересекающихся ограничивающих рамок посредством метрики IOU (Intersection over union) и объединения данных в кластеры по 2 и более пересечения, для отсекания ложных срабатываний. В результате имеем:
 
 <p align="center">
  <img src="https://github.com/Vladislav26Laptev/Smoke_detection/blob/main/data/Res_2.png">
</>
 
[:arrow_up:Оглавление](#оглавление)
 
## Итог
На данный момент разработана библиотека на базе языка Python и библиотек TensorFlow для распознавания пожароопасных объектов на основе технологии "object detection". Точность выявления пожаров на тестовой выборке составляет 75%.
 
[:arrow_up:Оглавление](#оглавление)
 
____
# Источники
1. Mingxing Tan, Ruoming Pang, Quoc V. Le, “Effi-cientDet: Scalable and Efficient Object Detection”, https://arxiv.org/abs/1911.09070
2. Object Detection | TensorFlow Hub, https://www.tensorflow.org/hub/tutorials/object_detection
